[tools]
# Use exact versions for reproducibility across environments
go = "1.24.13"
golangci-lint = "1.64.8"
git-cliff = "2.7.0"
hugo = "0.155.3"
# Required for GoReleaser SBOM generation and signing
syft = "1.21.0"
cosign = "2.4.3"

[env]
GOBIN = "{{config_root}}/.bin"
PATH = "{{config_root}}/.bin:{{env.PATH}}"

[tasks.build]
description = "Build all executables"
run = "make build"

[tasks.test]
description = "Run all tests"
run = "make test"

[tasks.lint]
description = "Run linter"
run = "make lint"

[tasks.tidy]
description = "Tidy go modules"
run = "make tidy"

[tasks.check]
description = "Quick pre-commit check"
run = "make check"

[tasks.verify]
description = "Run all checks (tidy, lint, test)"
depends = ["tidy", "lint", "test"]

[tasks.changelog]
description = "Generate changelog from git history"
run = "git cliff -o CHANGELOG.md"

[tasks.changelog-preview]
description = "Preview changelog changes"
run = "git cliff --unreleased"

[tasks."site:dev"]
description = "Start local docs dev server"
dir = "site"
run = """
bash scripts/inject-frontmatter.sh
hugo server --buildDrafts --navigateToChanged
"""

[tasks."docs-cli"]
description = "Generate CLI reference from cobra commands"
run = "make docs-cli"

[tasks."site:build"]
description = "Build the docs site (includes CLI reference generation)"
run = "bash site/scripts/build.sh"

[tasks."site:check"]
description = "Check docs site health (mounts + unmapped)"
run = """
bash site/scripts/check-mounts.sh
bash site/scripts/check-unmapped-docs.sh
"""

[tasks."site:clean"]
description = "Remove generated site artifacts"
run = "rm -rf site/.generated site/public site/resources"
